# 分布式主键ID

* 单机应用的主键ID vs. 分布式主键ID

### 分布式主键ID的生成方法总结

|                | 基于的组件 | 优点                                                         | 缺点                                                         |
| -------------- | ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| MySQL 主键自增 | MySQL      | 简单，ID严格递增                                             | 安全问题（由于ID结构简单，易被黑客预测到）；性能问题         |
| UUID           | 内存       | 安全简单                                                     | 性能问题（由于UUID是无序随机的字符串，无法高效利用数据库索引） |
| Redis          | Redis      |                                                              |                                                              |
| 雪花算法       | 内存       | 高性能（基于内存无需其他组件），高吞吐（每秒百万级），安全（结构复杂不易猜测），ID非严格递增 | 时间回拨问题                                                 |



### MySQL 水平分表的考虑

* 如果进行水平分表之后，多个表中会生成重复的 id 值。那么如何保证水平分表后的多张表中的 id 是全局唯一性的呢？

> 可以让不同表初始化一个不同的初始值，然后按指定的步长进行自增。例如有3张拆分表，初始主键值为1，2，3，自增步长为3。





### 雪花算法的问题

1. 时间回拨导致重复ID
2. 非严格递增（在单机上，生成的ID是递增的，但在多台机器上，只能大致保持递增趋势，并不能严格保证递增。这是因为多台机器之间的时钟不一定完全同步）







### Ref

* [一文读懂“Snowflake（雪花）”算法-腾讯云开发者社区-腾讯云](https://cloud.tencent.com/developer/article/2364487)
